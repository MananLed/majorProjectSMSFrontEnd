<div class="users">
  <div class="residents">
    <h3>Total Residents</h3>
    <div class="resident-count">
      <p-avatar
        label="{{ noOfResidents }}"
        class="mr-1"
        size="large"
        id="label"
      />
    </div>
  </div>
  <div class="officers">
    <h3>Total Officers</h3>
    <div class="officer-count">
      <p-avatar
        label="{{ noOfOfficers }}"
        class="mr-1"
        size="large"
        id="label"
      />
    </div>
  </div>
</div>
<br /><br /><br />

<div class="page-wrapper">
  <p-card class="card-container">
    <p-tabs value="0">
      <p-tablist>
        <p-tab value="0">Residents</p-tab>
        <p-tab value="1">Officers</p-tab>
      </p-tablist>
      <p-tabpanels>
        <p-tabpanel value="0">
          <br /><br />
          <p-table
            *ngIf="residentDetails!.data!.length > 0; else noResidents"
            [value]="residentDetails!.data"
            [tableStyle]="{ 'min-width': '50rem' }"
            [paginator]="residentDetails!.data!.length > 5"
            [rows]="5"
            [rowsPerPageOptions]="[5, 10, 20]"
          >
            <ng-template #header>
              <tr>
                <th pSortableColumn="first_name" style="width: 20%">
                  <div class="flex items-center gap-2">
                    Name
                    <p-sortIcon field="first_name" />
                  </div>
                </th>
                <th>Mobile</th>
                <th pSortableColumn="email" style="width: 20%">
                  <div class="flex items-center gap-2">
                    Email
                    <p-sortIcon field="email" />
                  </div>
                </th>
                <th pSortableColumn="flat" style="width: 20%">
                  <div class="flex items-center gap-2">
                    Flat
                    <p-sortIcon field="flat" />
                  </div>
                </th>
                <th>Actions</th>
              </tr>
            </ng-template>
            <ng-template #body let-data>
              <tr>
                <td>
                  {{ data.first_name }} {{ data.middle_name }}
                  {{ data.last_name }}
                </td>
                <td>{{ data.mobile_number }}</td>
                <td>{{ data.email }}</td>
                <td>{{ data.flat }}</td>
                <td>
                  <button
                    class="remove"
                    pButton
                    pTooltip="Remove Resident"
                    severity="danger"
                    icon="pi pi-trash"
                    (click)="deleteResident(data.id)"
                  ></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <ng-template #noResidents>
            <p>No Residents for now</p>
          </ng-template>
        </p-tabpanel>

        <p-tabpanel value="1">
          <div class="addOfficer">
            <button
              pButton
              class="add-officer-button"
              icon="pi pi-plus"
              pTooltip="Add Officer"
              (click)="showDialog()"
            ></button>
          </div>
          <p-table
            *ngIf="officerDetails!.data!.length > 0; else noOfficers"
            [value]="officerDetails!.data"
            [tableStyle]="{ 'min-width': '50rem' }"
            [paginator]="officerDetails!.data!.length > 5"
            [rows]="5"
            [rowsPerPageOptions]="[5, 10, 20]"
          >
            <ng-template #header>
              <tr>
                <th pSortableColumn="first_name" style="width: 20%">
                  <div class="flex items-center gap-2">
                    Name
                    <p-sortIcon field="first_name" />
                  </div>
                </th>
                <th>Mobile</th>
                <th pSortableColumn="email" style="width: 20%">
                  <div class="flex items-center gap-2">
                    Email
                    <p-sortIcon field="email" />
                  </div>
                </th>
                <th>Actions</th>
              </tr>
            </ng-template>
            <ng-template #body let-data>
              <tr>
                <td>
                  {{ data.first_name }} {{ data.middle_name }}
                  {{ data.last_name }}
                </td>
                <td>{{ data.mobile_number }}</td>
                <td>{{ data.email }}</td>
                <td>
                  <button
                    class="remove"
                    pButton
                    pTooltip="Remove Officer"
                    severity="danger"
                    icon="pi pi-trash"
                    (click)="deleteOfficer(data.id)"
                  ></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <ng-template #noOfficers>
            <p>No officers for now</p>
          </ng-template>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </p-card>
</div>

<p-dialog
  header="Add Officer"
  [modal]="true"
  [(visible)]="visible"
  [style]="{ width: '25rem' }"
  (onHide)="resetAddOfficerForm()"
>
  <form #addOfficerForm="ngForm" (ngSubmit)="addOfficer(addOfficerForm)">
    <span class="p-text-secondary block mb-8">Enter the details</span>
    <br /><br />
    <div class="field-container">
      <p-floatlabel variant="on">
        <input
          pInputText
          type="text"
          id="email"
          name="officerEmail"
          [(ngModel)]="officerEmail"
          autocomplete="off"
          required
          email
          #officerEmailControl="ngModel"
        />
        <label for="email">Email</label>
      </p-floatlabel>
      <div class="error-message-box">
        <span
          *ngIf="officerEmailControl.invalid && officerEmailControl.dirty"
          class="error-message"
        >
          <span *ngIf="officerEmailControl.errors?.['required']"
            >Email is required.</span
          >
          <span *ngIf="officerEmailControl.errors?.['email']"
            >Enter a valid email.</span
          >
        </span>
      </div>
    </div>
    <br />
    <div class="field-container">
      <p-floatlabel variant="on">
        <input
          pInputText
          type="password"
          id="password"
          name="officerPassword"
          [(ngModel)]="officerPassword"
          autocomplete="off"
          required
          pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*]).{12,}$"
          #officerPasswordControl="ngModel"
        />
        <label for="password">Password</label>
      </p-floatlabel>
       <div class="error-message-box">
        <span
          *ngIf="officerPasswordControl.invalid && (officerPasswordControl.dirty || officerPasswordControl.touched)"
          class="error-message"
        >
          <span *ngIf="officerPasswordControl.errors?.['required']">Password is required.</span>
          <span *ngIf="officerPasswordControl.errors?.['pattern']">
            Password must be at least 12 characters long and contain at least one lowercase letter, one uppercase letter, one number, and one special character.
          </span>
        </span>
      </div>
    </div>
    <br /><br />
    <div class="buttons">
      <p-button
        label="Cancel"
        severity="contrast"
        (onClick)="hideDialog()"
      ></p-button>
      <p-button
        [disabled]="addOfficerForm.invalid"
        label="Add"
        type="submit"
      ></p-button>
    </div>
  </form>
</p-dialog>

@if (isFetching()) {
<app-loader></app-loader>
}
